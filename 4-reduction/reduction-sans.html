
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SANS data reduction &#8212; ESS Data Management and Scientific Computing Summer School</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '4-reduction/reduction-sans';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model-dependent analysis" href="../5-analysis/intro.html" />
    <link rel="prev" title="QENS data reduction" href="reduction-qens.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">ESS Data Management and Scientific Computing Summer School</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://jupyterlab.readthedocs.io/en/stable/user/interface.html">Introduction to JupyterLab</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../1-python/python_basics.html">Python basics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../1-python/python_basics/basic_language_principles.html">Basic language principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/python_basics/sequence-data-types.html">Sequence data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/python_basics/control_structures.html">Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/python_basics/working-with-functions.html">Working with functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/python_basics/intermediate_topics.html">Intermediate topics</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../1-python/using_external_libraries.html">Using external libraries</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../1-python/using_external_libraries/numpy.html">Arrays with Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/using_external_libraries/matplotlib.html">Plotting with Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/using_external_libraries/ipywidgets.html">Interactive widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/using_external_libraries/pandas.html">Data analysis with Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1-python/using_external_libraries/unit_testing.html">Unit testing</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Proposals, DMPs and FAIR</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://ess-dmsc-dram.github.io/winter-school/_static/proposals.pdf">The ESS Viewpoint</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">McStas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../3-mcstas/Simulation.html">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-mcstas/mcstas-powder-diffraction.html">Powder diffraction exercise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-mcstas/mcstas-qens.html">QENS exercise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-mcstas/mcstas-sans.html">SANS exercise</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reduction with scipp</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scipp-introduction.html">Introduction to Scipp</a></li>
<li class="toctree-l1"><a class="reference internal" href="coord-transforms.html">Coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="reduction-powder-diffraction.html">Powder diffraction data reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="reduction-qens.html">QENS data reduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SANS data reduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analysis with EasyScience</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/intro.html">Model-dependent analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/prob_data.html">Thinking about data probabilistically</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/easy_intro.html">The <code class="docutils literal notranslate"><span class="pre">EasyScience</span></code> framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/fitting.html">Fitting data with <code class="docutils literal notranslate"><span class="pre">easyscience</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/bayes.html">Uniform priors in <code class="docutils literal notranslate"><span class="pre">easyscience</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/analysis-powder-diffraction.html">Fitting Powder Diffraction data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/analysis-qens.html">Fitting QENS data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/analysis-sans.html">Fitting SANS data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/mcmc.html">Markov chain Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/nested_sampling.html">Bayesian Model Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/powder_ns.html">Bayesian analysis of powder diffraction data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/qens_ns.html">Bayesian analysis of QENS data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-analysis/sans_ns.html">Bayesian analysis of SANS data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Scicat</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/1-dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/2-data_curation.html">Data Curation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/3-fair_data.html">FAIR Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/4-data_metadata.html">Data and Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/5-data_catalog.html">Data Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/6-scicat.html">SciCat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/7-python_libraries.html">Python Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/8-example.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6-scicat/9-exercise.html">Data Curation Exercise</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">DMSC School Lecture Materials</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ess-dmsc-dram/winter-school" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ess-dmsc-dram/winter-school/issues/new?title=Issue%20on%20page%20%2F4-reduction/reduction-sans.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/4-reduction/reduction-sans.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SANS data reduction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#process-the-run-with-a-sample">Process the run with a sample</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-nexus-file-data">Load the NeXus file data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-data">Visualize the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-transformations">Coordinate transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-convert-raw-data-to-q">Exercise 1: convert raw data to <span class="math notranslate nohighlight">\(Q\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-the-data-in-q">Histogram the data in <span class="math notranslate nohighlight">\(Q\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-process-flat-field-run">Exercise 2: process flat-field run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-normalize-the-sample-run">Exercise 3: Normalize the sample run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-result-to-disk">Save result to disk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bonus-exercise">Bonus exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sciline-workflow">Sciline workflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-set-the-workflow-parameters">Exercise 4: Set the workflow parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-make-a-2-theta-q-map">Exercise 5: Make a <span class="math notranslate nohighlight">\((2\theta, Q)\)</span> map</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sans-data-reduction">
<h1>SANS data reduction<a class="headerlink" href="#sans-data-reduction" title="Link to this heading">#</a></h1>
<p>This notebook will guide you through the data reduction for the SANS experiment that you simulated with McStas yesterday.</p>
<p>The following is a basic outline of what this notebook will cover:</p>
<ul class="simple">
<li><p>Loading the NeXus files that contain the data</p></li>
<li><p>Inspect/visualize the data contents</p></li>
<li><p>How to convert the raw <code class="docutils literal notranslate"><span class="pre">time-of-flight</span></code> coordinate to something more useful (<span class="math notranslate nohighlight">\(\lambda\)</span>, <span class="math notranslate nohighlight">\(Q\)</span>, …)</p></li>
<li><p>Normalize to a flat field run</p></li>
<li><p>Write the results to file</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plopp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sans_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">utils</span>
</pre></div>
</div>
</div>
</div>
<section id="process-the-run-with-a-sample">
<h2>Process the run with a sample<a class="headerlink" href="#process-the-run-with-a-sample" title="Link to this heading">#</a></h2>
<section id="load-the-nexus-file-data">
<h3>Load the NeXus file data<a class="headerlink" href="#load-the-nexus-file-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;../3-mcstas/SANS_with_sample_many_neutrons&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_sans</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The first way to inspect the data is to view the HTML representation of the loaded object.</p>
<p>Try to explore what is inside the data, and familiarize yourself with the different sections (<code class="docutils literal notranslate"><span class="pre">Dimensions</span></code>, <code class="docutils literal notranslate"><span class="pre">Coordinates</span></code>, <code class="docutils literal notranslate"><span class="pre">Data</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (1.28 GB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-da94bc56-e319-4487-bc1a-ae093b1819b6' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-da94bc56-e319-4487-bc1a-ae093b1819b6' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span>event</span>: 21501155</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-09dd5559-33c1-45eb-a037-ed9773753f02' class='sc-section-summary-in' type='checkbox'  checked><label for='section-09dd5559-33c1-45eb-a037-ed9773753f02' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(6)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>position</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0.         0.05493921 3.        ], [0.        0.0469225 3.       ], ..., [0.         0.47881586 3.        ], [0.        0.4760945 3.       ]</div></span></div><input id='attrs-064ecc8f-b077-43c1-9889-4cb41a5e5873' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-064ecc8f-b077-43c1-9889-4cb41a5e5873' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-75e30a92-1253-4e5e-ac93-4b0fc7148979' class='sc-var-data-in' type='checkbox'><label for='data-75e30a92-1253-4e5e-ac93-4b0fc7148979' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.        , 0.05493921, 3.        ],
       [0.        , 0.0469225 , 3.        ],
       [0.        , 0.04602234, 3.        ],
       ...,
       [0.        , 0.47801485, 3.        ],
       [0.        , 0.47881586, 3.        ],
       [0.        , 0.4760945 , 3.        ]], shape=(21501155, 3))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-bdd67421-0299-41b3-952b-83837a438cb3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-bdd67421-0299-41b3-952b-83837a438cb3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c3500197-4d97-4304-bda1-87c5d5757c3c' class='sc-var-data-in' type='checkbox'><label for='data-c3500197-4d97-4304-bda1-87c5d5757c3c' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[   0.    0. -150.]</div></span></div><input id='attrs-dc1e9ff7-e5f5-4147-b7e8-68e40c8154f5' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-dc1e9ff7-e5f5-4147-b7e8-68e40c8154f5' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d1a294c1-8808-4ead-8a33-3c8260f07097' class='sc-var-data-in' type='checkbox'><label for='data-d1a294c1-8808-4ead-8a33-3c8260f07097' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   0.,    0., -150.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>tof</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>ms</div><div class='sc-value-preview sc-preview'><span><div>261.952, 261.998, ..., 258.606, 258.612</div></span></div><input id='attrs-bbe077dd-bbd3-4811-a2cd-55164c2a02b8' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-bbe077dd-bbd3-4811-a2cd-55164c2a02b8' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b9b02b15-65ca-45f9-b857-feca88ee7fdc' class='sc-var-data-in' type='checkbox'><label for='data-b9b02b15-65ca-45f9-b857-feca88ee7fdc' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([261.95206827, 261.99832783, 262.00425018, ..., 258.60055769,
       258.60572821, 258.6116965 ], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>x</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-fdc9f768-2726-4f09-964a-21487e43d2d9' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-fdc9f768-2726-4f09-964a-21487e43d2d9' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-52e53ba1-98b6-4bff-bc8c-564105a126e6' class='sc-var-data-in' type='checkbox'><label for='data-52e53ba1-98b6-4bff-bc8c-564105a126e6' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0., ..., 0., 0., 0.], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>y</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>0.055, 0.047, ..., 0.479, 0.476</div></span></div><input id='attrs-4c89d06a-1d80-4c1b-a86b-95aca3f5fa61' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4c89d06a-1d80-4c1b-a86b-95aca3f5fa61' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-227af7bb-110a-4519-9345-865b161755f5' class='sc-var-data-in' type='checkbox'><label for='data-227af7bb-110a-4519-9345-865b161755f5' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.05493921, 0.0469225 , 0.04602234, ..., 0.47801485, 0.47881586,
       0.4760945 ], shape=(21501155,))</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-1dc74ca9-fbba-420c-8c62-48a192bafe10' class='sc-section-summary-in' type='checkbox'  checked><label for='section-1dc74ca9-fbba-420c-8c62-48a192bafe10' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>7.510e-07, 6.125e-11, ..., 1.292e-34, 1.075e-38</div></span><span><div>σ = 7.510e-07, 6.125e-11, ..., 1.292e-34, 1.075e-38</div></span></div><input id='attrs-3f6800f8-615d-4f15-ab0e-0448478ebc08' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-3f6800f8-615d-4f15-ab0e-0448478ebc08' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-abaae178-7a60-4e83-bbff-09289b3da3b1' class='sc-var-data-in' type='checkbox'><label for='data-abaae178-7a60-4e83-bbff-09289b3da3b1' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([7.50980710e-07, 6.12509677e-11, 4.99570893e-15, ...,
       1.55235680e-30, 1.29161068e-34, 1.07466154e-38], shape=(21501155,))<br><br>Variances (σ²):<br>array([5.63972026e-13, 3.75168104e-21, 2.49571077e-29, ...,
       2.40981164e-60, 1.66825815e-68, 1.15489742e-76], shape=(21501155,))</pre></li></ul></div></li></ul></div></div></div></div>
</div>
</section>
<section id="visualize-the-data">
<h3>Visualize the data<a class="headerlink" href="#visualize-the-data" title="Link to this heading">#</a></h3>
<p>Here is a 2D visualization of the neutron counts, histogrammed along the <code class="docutils literal notranslate"><span class="pre">tof</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> dimensions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tof</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1.0e-2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d4c55ebeb31a3effbb5b28259d3f20fe964e0da8dcc378376d82cbe2cee6a65a.svg" src="../_images/d4c55ebeb31a3effbb5b28259d3f20fe964e0da8dcc378376d82cbe2cee6a65a.svg" />
</div>
</div>
<p>Histogramming along <code class="docutils literal notranslate"><span class="pre">y</span></code> only gives a 1D plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8f3221543e6c3e6e3484bde4ef6197291df055e7a301f51c96a7695710211636.svg" src="../_images/8f3221543e6c3e6e3484bde4ef6197291df055e7a301f51c96a7695710211636.svg" />
</div>
</div>
</section>
<section id="coordinate-transformations">
<h3>Coordinate transformations<a class="headerlink" href="#coordinate-transformations" title="Link to this heading">#</a></h3>
<p>The first step in the data reduction is to convert the raw event coordinates (position, time-of-flight) to something physically meaningful such as wavelength (<span class="math notranslate nohighlight">\(\lambda\)</span>) or momentum transfer (<span class="math notranslate nohighlight">\(Q\)</span>).</p>
<p>Scipp has a dedicated method for this called <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> (see docs <a class="reference external" href="https://scipp.github.io/scippneutron/user-guide/coordinate-transformations.html">here</a>).</p>
<p>We begin with a standard graph which describes how to compute e.g. the wavelength from the other coordinates in the raw data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion.graph.beamline</span><span class="w"> </span><span class="kn">import</span> <span class="n">beamline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.conversion.graph.tof</span><span class="w"> </span><span class="kn">import</span> <span class="n">kinematic</span>

<span class="n">graph</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">beamline</span><span class="p">(</span><span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">kinematic</span><span class="p">(</span><span class="s2">&quot;tof&quot;</span><span class="p">)}</span>
<span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b2ba5ca46c8f506c34751deff73cd9cba2c2f875b2e18fb014d5ba4d773aef4c.svg" src="../_images/b2ba5ca46c8f506c34751deff73cd9cba2c2f875b2e18fb014d5ba4d773aef4c.svg" />
</div>
</div>
<p>To compute the wavelength of all the events, we simply call <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> on our loaded data,
requesting the name of the coordinate we want in the output (<code class="docutils literal notranslate"><span class="pre">&quot;wavelength&quot;</span></code>),
as well as providing it the graph to be used to compute it (i.e. the one we defined just above).</p>
<p>This yields</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_wav</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
<span class="n">sample_wav</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (2.24 GB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-b8005968-a0ae-41f2-a7c9-b8a8d977018c' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-b8005968-a0ae-41f2-a7c9-b8a8d977018c' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span>event</span>: 21501155</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-9af35b09-4e5c-4a52-893d-e4204e61ccc4' class='sc-section-summary-in' type='checkbox'  checked><label for='section-9af35b09-4e5c-4a52-893d-e4204e61ccc4' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(12)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>L1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>150.0</div></span></div><input id='attrs-c8b7d0cb-1dc2-413c-8ef9-f66910721154' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-c8b7d0cb-1dc2-413c-8ef9-f66910721154' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c3cb3b0c-94d8-4be2-aee2-5e3ffe49d78b' class='sc-var-data-in' type='checkbox'><label for='data-c3cb3b0c-94d8-4be2-aee2-5e3ffe49d78b' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(150.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>L2</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>3.001, 3.000, ..., 3.038, 3.038</div></span></div><input id='attrs-eeb1bc4c-27a9-4701-a58d-0dae09da2eaa' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-eeb1bc4c-27a9-4701-a58d-0dae09da2eaa' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-33d45df0-17c1-491d-a109-7c8efcbeb0dd' class='sc-var-data-in' type='checkbox'><label for='data-33d45df0-17c1-491d-a109-7c8efcbeb0dd' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([3.00050301, 3.00036693, 3.00035299, ..., 3.03784433, 3.03797048,
       3.03754275], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>153.001, 153.000, ..., 153.038, 153.038</div></span></div><input id='attrs-6eb26eb2-55c0-4a21-8e02-ba3b1e0c530d' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6eb26eb2-55c0-4a21-8e02-ba3b1e0c530d' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7be6bbd7-3e9b-4e0a-bf37-1bb4ea47fd88' class='sc-var-data-in' type='checkbox'><label for='data-7be6bbd7-3e9b-4e0a-bf37-1bb4ea47fd88' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([153.00050301, 153.00036693, 153.00035299, ..., 153.03784433,
       153.03797048, 153.03754275], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>incident_beam</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.   0. 150.]</div></span></div><input id='attrs-e435409d-9fd8-408a-a323-3166dccba04b' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-e435409d-9fd8-408a-a323-3166dccba04b' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bc78dc04-6a35-4058-8770-d34710fcc11b' class='sc-var-data-in' type='checkbox'><label for='data-bc78dc04-6a35-4058-8770-d34710fcc11b' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.,   0., 150.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0.         0.05493921 3.        ], [0.        0.0469225 3.       ], ..., [0.         0.47881586 3.        ], [0.        0.4760945 3.       ]</div></span></div><input id='attrs-5099047f-bd08-41af-af70-a9b6764b3b21' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-5099047f-bd08-41af-af70-a9b6764b3b21' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4d569418-a504-4167-b662-635192458d4e' class='sc-var-data-in' type='checkbox'><label for='data-4d569418-a504-4167-b662-635192458d4e' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.        , 0.05493921, 3.        ],
       [0.        , 0.0469225 , 3.        ],
       [0.        , 0.04602234, 3.        ],
       ...,
       [0.        , 0.47801485, 3.        ],
       [0.        , 0.47881586, 3.        ],
       [0.        , 0.4760945 , 3.        ]], shape=(21501155, 3))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-1938a131-6945-418b-b960-acd044197efb' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1938a131-6945-418b-b960-acd044197efb' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-eecaade1-4b50-484b-8b45-b2b01320fa6a' class='sc-var-data-in' type='checkbox'><label for='data-eecaade1-4b50-484b-8b45-b2b01320fa6a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>scattered_beam</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0.         0.05493921 3.        ], [0.        0.0469225 3.       ], ..., [0.         0.47881586 3.        ], [0.        0.4760945 3.       ]</div></span></div><input id='attrs-784ef1ba-a4be-41ed-a829-2c553f00656b' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-784ef1ba-a4be-41ed-a829-2c553f00656b' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f5fa9485-bbbf-4b05-bee9-4f0732b84e8a' class='sc-var-data-in' type='checkbox'><label for='data-f5fa9485-bbbf-4b05-bee9-4f0732b84e8a' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.        , 0.05493921, 3.        ],
       [0.        , 0.0469225 , 3.        ],
       [0.        , 0.04602234, 3.        ],
       ...,
       [0.        , 0.47801485, 3.        ],
       [0.        , 0.47881586, 3.        ],
       [0.        , 0.4760945 , 3.        ]], shape=(21501155, 3))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[   0.    0. -150.]</div></span></div><input id='attrs-4b2d2266-ab5c-45df-be07-308d67d72088' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4b2d2266-ab5c-45df-be07-308d67d72088' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6c0a543e-b619-4bf5-84ce-220636ba456b' class='sc-var-data-in' type='checkbox'><label for='data-6c0a543e-b619-4bf5-84ce-220636ba456b' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   0.,    0., -150.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>ms</div><div class='sc-value-preview sc-preview'><span><div>261.952, 261.998, ..., 258.606, 258.612</div></span></div><input id='attrs-4cc95ddc-59d9-435d-ad1a-bc186402fae8' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-4cc95ddc-59d9-435d-ad1a-bc186402fae8' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d7f1b80b-a8fc-47b1-adf9-9f97584824fa' class='sc-var-data-in' type='checkbox'><label for='data-d7f1b80b-a8fc-47b1-adf9-9f97584824fa' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([261.95206827, 261.99832783, 262.00425018, ..., 258.60055769,
       258.60572821, 258.6116965 ], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>wavelength</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>6.773, 6.774, ..., 6.685, 6.685</div></span></div><input id='attrs-12c7fd6c-30ae-4484-bfd7-216c69503fa6' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-12c7fd6c-30ae-4484-bfd7-216c69503fa6' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b5956123-b932-47ae-aedb-b0cae9f6e7f7' class='sc-var-data-in' type='checkbox'><label for='data-b5956123-b932-47ae-aedb-b0cae9f6e7f7' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([6.77312342, 6.77432555, 6.7744793 , ..., 6.6848341 , 6.68496225,
       6.68513521], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>x</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-1cc4c584-3e56-44e9-aa67-f74b79e6f5c3' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-1cc4c584-3e56-44e9-aa67-f74b79e6f5c3' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e9a7bf14-a9a0-421e-b1b2-250305d959a8' class='sc-var-data-in' type='checkbox'><label for='data-e9a7bf14-a9a0-421e-b1b2-250305d959a8' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0., ..., 0., 0., 0.], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>y</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>0.055, 0.047, ..., 0.479, 0.476</div></span></div><input id='attrs-f4b5beca-52ea-448a-bd7a-29f951939aee' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-f4b5beca-52ea-448a-bd7a-29f951939aee' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-980be99e-feab-4121-be2f-cdbddaea3d4e' class='sc-var-data-in' type='checkbox'><label for='data-980be99e-feab-4121-be2f-cdbddaea3d4e' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.05493921, 0.0469225 , 0.04602234, ..., 0.47801485, 0.47881586,
       0.4760945 ], shape=(21501155,))</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-008ef74f-979a-4a81-8350-6f77213b6ff1' class='sc-section-summary-in' type='checkbox'  checked><label for='section-008ef74f-979a-4a81-8350-6f77213b6ff1' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>7.510e-07, 6.125e-11, ..., 1.292e-34, 1.075e-38</div></span><span><div>σ = 7.510e-07, 6.125e-11, ..., 1.292e-34, 1.075e-38</div></span></div><input id='attrs-15ab19e1-fae2-4fc2-8d3d-2f5eb3f4dd81' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-15ab19e1-fae2-4fc2-8d3d-2f5eb3f4dd81' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e2ae957c-8631-41bc-8d95-e3ddbf33e71b' class='sc-var-data-in' type='checkbox'><label for='data-e2ae957c-8631-41bc-8d95-e3ddbf33e71b' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([7.50980710e-07, 6.12509677e-11, 4.99570893e-15, ...,
       1.55235680e-30, 1.29161068e-34, 1.07466154e-38], shape=(21501155,))<br><br>Variances (σ²):<br>array([5.63972026e-13, 3.75168104e-21, 2.49571077e-29, ...,
       2.40981164e-60, 1.66825815e-68, 1.15489742e-76], shape=(21501155,))</pre></li></ul></div></li></ul></div></div></div></div>
</div>
<p>The result has a <code class="docutils literal notranslate"><span class="pre">wavelength</span></code> coordinate. We can also plot the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_wav</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">wavelength</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/521dbfc72aa8d3abd4340ad62b99ee1ceb93eef7ceb7a11f702d99efcfd64d1f.svg" src="../_images/521dbfc72aa8d3abd4340ad62b99ee1ceb93eef7ceb7a11f702d99efcfd64d1f.svg" />
</div>
</div>
<p>We can see that the range of observed wavelengths agrees with the range set in the McStas model (5.25 - 6.75 Å)</p>
</section>
<section id="exercise-1-convert-raw-data-to-q">
<h3>Exercise 1: convert raw data to <span class="math notranslate nohighlight">\(Q\)</span><a class="headerlink" href="#exercise-1-convert-raw-data-to-q" title="Link to this heading">#</a></h3>
<p>Instead of wavelength as in the example above,
the task is now to convert the raw data to momentum-transfer <span class="math notranslate nohighlight">\(Q\)</span>.</p>
<p>The transformation graph is missing the computation for <span class="math notranslate nohighlight">\(Q\)</span> so you will have to add it in yourself.
As a reminder, <span class="math notranslate nohighlight">\(Q\)</span> is computed as follows</p>
<div class="math notranslate nohighlight">
\[Q = \frac{4\pi \sin(\theta)}{\lambda}\]</div>
<p>You have to:</p>
<ul class="simple">
<li><p>create a function that computes <span class="math notranslate nohighlight">\(Q\)</span></p></li>
<li><p>add it to the graph</p></li>
<li><p>call <code class="docutils literal notranslate"><span class="pre">transform_coords</span></code> using the new graph</p></li>
</ul>
<p>Note that the graph already contains the necessary components to compute the scattering angle <span class="math notranslate nohighlight">\(2 \theta\)</span> (called <code class="docutils literal notranslate"><span class="pre">two_theta</span></code> in code).</p>
<p><strong>Solution:</strong></p>
<div class="cell tag_hide-cell tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_q</span><span class="p">(</span><span class="n">two_theta</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">two_theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">wavelength</span>


<span class="n">graph</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_q</span>

<span class="c1"># Show the updated graph</span>
<span class="n">display</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">show_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># Run the coordinate transformation</span>
<span class="n">sample_q</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
<span class="n">sample_q</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7c13132c96f1db9aeb205740074adcef49924b68b608f3fb36bbc2aa7850be8d.svg" src="../_images/7c13132c96f1db9aeb205740074adcef49924b68b608f3fb36bbc2aa7850be8d.svg" />
<div class="output text_html"><div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (2.56 GB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-36b145ed-70b5-4997-a4f0-eb6712825445' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-36b145ed-70b5-4997-a4f0-eb6712825445' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span>event</span>: 21501155</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-6473cce5-aa0d-4675-8eed-1de6b7f1cd3a' class='sc-section-summary-in' type='checkbox'  checked><label for='section-6473cce5-aa0d-4675-8eed-1de6b7f1cd3a' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(14)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span>L1</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>150.0</div></span></div><input id='attrs-97611855-619a-40a9-96c0-91872c79ac76' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-97611855-619a-40a9-96c0-91872c79ac76' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-82d7b986-3e06-422e-ab5e-c729aafbb094' class='sc-var-data-in' type='checkbox'><label for='data-82d7b986-3e06-422e-ab5e-c729aafbb094' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array(150.)</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>L2</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>3.001, 3.000, ..., 3.038, 3.038</div></span></div><input id='attrs-d1e82516-7d03-4258-a4a9-374d51b51066' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-d1e82516-7d03-4258-a4a9-374d51b51066' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b4af641c-295f-4230-91c5-71a108bc3dab' class='sc-var-data-in' type='checkbox'><label for='data-b4af641c-295f-4230-91c5-71a108bc3dab' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([3.00050301, 3.00036693, 3.00035299, ..., 3.03784433, 3.03797048,
       3.03754275], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>Ltotal</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>153.001, 153.000, ..., 153.038, 153.038</div></span></div><input id='attrs-0b1f1e48-232d-4e08-a2bd-c57c13cff3bf' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-0b1f1e48-232d-4e08-a2bd-c57c13cff3bf' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-41f0a9f8-7b5c-4db4-ab23-b67efe5340fd' class='sc-var-data-in' type='checkbox'><label for='data-41f0a9f8-7b5c-4db4-ab23-b67efe5340fd' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([153.00050301, 153.00036693, 153.00035299, ..., 153.03784433,
       153.03797048, 153.03754275], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>Q</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>1/Å</div><div class='sc-value-preview sc-preview'><span><div>0.017, 0.015, ..., 0.149, 0.148</div></span></div><input id='attrs-5c7384da-e2f0-41f2-871a-ca8352ba215a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-5c7384da-e2f0-41f2-871a-ca8352ba215a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4bfd799c-f3bc-412b-bf06-e471dfdfe3a7' class='sc-var-data-in' type='checkbox'><label for='data-4bfd799c-f3bc-412b-bf06-e471dfdfe3a7' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.01698625, 0.01450554, 0.01422699, ..., 0.14836174, 0.14860286,
       0.14777009], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>incident_beam</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[  0.   0. 150.]</div></span></div><input id='attrs-c5b5bc00-5a4c-41ba-a60d-e47a93e4823f' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-c5b5bc00-5a4c-41ba-a60d-e47a93e4823f' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-767d5853-b048-4456-a009-6eb011e8d7f8' class='sc-var-data-in' type='checkbox'><label for='data-767d5853-b048-4456-a009-6eb011e8d7f8' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([  0.,   0., 150.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>position</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0.         0.05493921 3.        ], [0.        0.0469225 3.       ], ..., [0.         0.47881586 3.        ], [0.        0.4760945 3.       ]</div></span></div><input id='attrs-534f4600-3207-4321-8f02-fd6e7eaf2658' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-534f4600-3207-4321-8f02-fd6e7eaf2658' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98afc2cf-b79d-43d8-9e6a-e607d8964a39' class='sc-var-data-in' type='checkbox'><label for='data-98afc2cf-b79d-43d8-9e6a-e607d8964a39' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.        , 0.05493921, 3.        ],
       [0.        , 0.0469225 , 3.        ],
       [0.        , 0.04602234, 3.        ],
       ...,
       [0.        , 0.47801485, 3.        ],
       [0.        , 0.47881586, 3.        ],
       [0.        , 0.4760945 , 3.        ]], shape=(21501155, 3))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>sample_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0. 0. 0.]</div></span></div><input id='attrs-0e4d5447-2f4d-4b5b-80d6-de47c6016a11' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-0e4d5447-2f4d-4b5b-80d6-de47c6016a11' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b805686f-32a8-4733-9afe-518aa966cd31' class='sc-var-data-in' type='checkbox'><label for='data-b805686f-32a8-4733-9afe-518aa966cd31' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>scattered_beam</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[0.         0.05493921 3.        ], [0.        0.0469225 3.       ], ..., [0.         0.47881586 3.        ], [0.        0.4760945 3.       ]</div></span></div><input id='attrs-980cddc6-f4e1-4857-820a-e566965b8c45' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-980cddc6-f4e1-4857-820a-e566965b8c45' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-89adc3b7-aea9-4feb-8f4f-fb588fa00637' class='sc-var-data-in' type='checkbox'><label for='data-89adc3b7-aea9-4feb-8f4f-fb588fa00637' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([[0.        , 0.05493921, 3.        ],
       [0.        , 0.0469225 , 3.        ],
       [0.        , 0.04602234, 3.        ],
       ...,
       [0.        , 0.47801485, 3.        ],
       [0.        , 0.47881586, 3.        ],
       [0.        , 0.4760945 , 3.        ]], shape=(21501155, 3))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>source_position</span></div><div class='sc-var-dims'>()</div><div class='sc-var-dtype'>vector3</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>[   0.    0. -150.]</div></span></div><input id='attrs-0de242cc-98c4-4331-b437-593ba6aae96a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-0de242cc-98c4-4331-b437-593ba6aae96a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e2d2027f-6f10-4145-9a99-74bc6e21b755' class='sc-var-data-in' type='checkbox'><label for='data-e2d2027f-6f10-4145-9a99-74bc6e21b755' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([   0.,    0., -150.])</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>tof</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>ms</div><div class='sc-value-preview sc-preview'><span><div>261.952, 261.998, ..., 258.606, 258.612</div></span></div><input id='attrs-475bdb7a-2966-4293-8c20-fee0a715c4e5' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-475bdb7a-2966-4293-8c20-fee0a715c4e5' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f67a28df-dc25-4c92-929b-8780e68c7ca1' class='sc-var-data-in' type='checkbox'><label for='data-f67a28df-dc25-4c92-929b-8780e68c7ca1' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([261.95206827, 261.99832783, 262.00425018, ..., 258.60055769,
       258.60572821, 258.6116965 ], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>two_theta</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>rad</div><div class='sc-value-preview sc-preview'><span><div>0.018, 0.016, ..., 0.158, 0.157</div></span></div><input id='attrs-f559367e-26d9-43e1-9374-851255737827' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-f559367e-26d9-43e1-9374-851255737827' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d0718417-4898-4c94-9f67-8969b2604036' class='sc-var-data-in' type='checkbox'><label for='data-d0718417-4898-4c94-9f67-8969b2604036' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.01831102, 0.01563956, 0.01533958, ..., 0.15801   , 0.15827038,
       0.15738567], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span>wavelength</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>6.773, 6.774, ..., 6.685, 6.685</div></span></div><input id='attrs-fd933d92-12a8-431c-af75-ed09e750450a' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-fd933d92-12a8-431c-af75-ed09e750450a' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-270c48a0-a3ef-4f3e-a86d-613e3420c5ea' class='sc-var-data-in' type='checkbox'><label for='data-270c48a0-a3ef-4f3e-a86d-613e3420c5ea' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([6.77312342, 6.77432555, 6.7744793 , ..., 6.6848341 , 6.68496225,
       6.68513521], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>x</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>0.0, 0.0, ..., 0.0, 0.0</div></span></div><input id='attrs-ef8bd146-5919-4527-ac18-6d7bf61c9e80' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-ef8bd146-5919-4527-ac18-6d7bf61c9e80' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2f3ecf84-b24e-4eae-945c-0209d642f9bb' class='sc-var-data-in' type='checkbox'><label for='data-2f3ecf84-b24e-4eae-945c-0209d642f9bb' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0., 0., 0., ..., 0., 0., 0.], shape=(21501155,))</pre></span></li><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>y</span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>m</div><div class='sc-value-preview sc-preview'><span><div>0.055, 0.047, ..., 0.479, 0.476</div></span></div><input id='attrs-6dbd7f7b-c153-430d-a378-04501d19b020' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-6dbd7f7b-c153-430d-a378-04501d19b020' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0c45e14a-0153-48d0-bef4-8a7d3dde2086' class='sc-var-data-in' type='checkbox'><label for='data-0c45e14a-0153-48d0-bef4-8a7d3dde2086' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.05493921, 0.0469225 , 0.04602234, ..., 0.47801485, 0.47881586,
       0.4760945 ], shape=(21501155,))</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-1cea9ae0-e822-4d14-9a2a-5a8472db9353' class='sc-section-summary-in' type='checkbox'  checked><label for='section-1cea9ae0-e822-4d14-9a2a-5a8472db9353' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(event)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>counts</div><div class='sc-value-preview sc-preview'><span><div>7.510e-07, 6.125e-11, ..., 1.292e-34, 1.075e-38</div></span><span><div>σ = 7.510e-07, 6.125e-11, ..., 1.292e-34, 1.075e-38</div></span></div><input id='attrs-bf430b7f-bd9c-4c9f-87c8-7bf541c48543' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-bf430b7f-bd9c-4c9f-87c8-7bf541c48543' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9c38c52f-e34e-4de8-90f3-7342f83ae1f1' class='sc-var-data-in' type='checkbox'><label for='data-9c38c52f-e34e-4de8-90f3-7342f83ae1f1' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([7.50980710e-07, 6.12509677e-11, 4.99570893e-15, ...,
       1.55235680e-30, 1.29161068e-34, 1.07466154e-38], shape=(21501155,))<br><br>Variances (σ²):<br>array([5.63972026e-13, 3.75168104e-21, 2.49571077e-29, ...,
       2.40981164e-60, 1.66825815e-68, 1.15489742e-76], shape=(21501155,))</pre></li></ul></div></li></ul></div></div></div></div>
</details>
</div>
</section>
<section id="histogram-the-data-in-q">
<h3>Histogram the data in <span class="math notranslate nohighlight">\(Q\)</span><a class="headerlink" href="#histogram-the-data-in-q" title="Link to this heading">#</a></h3>
<p>The final step in processing the sample run is to histogram the data into <span class="math notranslate nohighlight">\(Q\)</span> bins.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_h</span> <span class="o">=</span> <span class="n">sample_q</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">sample_h</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f5b4aa827e58c0f04695acb63bde4a340b374f44fc8426cec1b6c7fb3e479976.svg" src="../_images/f5b4aa827e58c0f04695acb63bde4a340b374f44fc8426cec1b6c7fb3e479976.svg" />
</div>
</div>
</section>
</section>
<section id="exercise-2-process-flat-field-run">
<h2>Exercise 2: process flat-field run<a class="headerlink" href="#exercise-2-process-flat-field-run" title="Link to this heading">#</a></h2>
<p>Repeat the step carried out above for the run that contained no sample (also known as a “flat-field” run).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;../3-mcstas/SANS_without_sample_many_neutrons&quot;</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Solution:</strong></p>
<div class="cell tag_hide-cell tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;../3-mcstas/SANS_without_sample_many_neutrons&quot;</span>
<span class="c1"># Load file</span>
<span class="n">flat</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_sans</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

<span class="c1"># Convert to Q</span>
<span class="n">flat_q</span> <span class="o">=</span> <span class="n">flat</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>

<span class="c1"># Histogram</span>
<span class="n">flat_h</span> <span class="o">=</span> <span class="n">flat_q</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">flat_h</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/be2bf98e197e18b27dfc521f5e7c27a9afcf938885b772fa6aae364b0121fb45.svg" src="../_images/be2bf98e197e18b27dfc521f5e7c27a9afcf938885b772fa6aae364b0121fb45.svg" />
</div>
</details>
</div>
<p><strong>Bonus question:</strong> can you explain why the counts in the flat-field data drop at high <span class="math notranslate nohighlight">\(Q\)</span>?</p>
</section>
<section id="exercise-3-normalize-the-sample-run">
<h2>Exercise 3: Normalize the sample run<a class="headerlink" href="#exercise-3-normalize-the-sample-run" title="Link to this heading">#</a></h2>
<p>The flat-field run is giving a measure of the efficiency of each detector pixel.
This efficiency now needs to be used to correct the counts in the sample run to yield a realistic <span class="math notranslate nohighlight">\(I(Q)\)</span> profile.</p>
<p>In particular, this should remove any unwanted artifacts in the data,
such as the drop in counts around 0.03 Å<sup>-1</sup> due to the air bubble inside the detector tube.</p>
<p>Normalizing is essentially just dividing the sample run by the flat field run.</p>
<p><strong>Hint:</strong> you may run into an error like <code class="docutils literal notranslate"><span class="pre">&quot;Mismatch</span> <span class="pre">in</span> <span class="pre">coordinate</span> <span class="pre">'Q'&quot;</span></code>. Why is this happening? How can you get around it?</p>
<p><strong>Solution:</strong></p>
<div class="cell tag_raises-exception tag_hide-cell tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normed</span> <span class="o">=</span> <span class="n">sample_h</span> <span class="o">/</span> <span class="n">flat_h</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">DatasetError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">normed</span> <span class="o">=</span> <span class="n">sample_h</span> <span class="o">/</span> <span class="n">flat_h</span>

<span class="ne">DatasetError</span>: Mismatch in coordinate &#39;Q&#39; in operation &#39;divide&#39;:
<span class="p">(</span><span class="n">Q</span><span class="p">:</span> <span class="mi">201</span><span class="p">)</span>    <span class="n">float64</span>           <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">Å</span><span class="p">]</span>  <span class="p">[</span><span class="mf">0.00451426</span><span class="p">,</span> <span class="mf">0.00544818</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.190366</span><span class="p">,</span> <span class="mf">0.1913</span><span class="p">]</span>
<span class="n">vs</span>
<span class="p">(</span><span class="n">Q</span><span class="p">:</span> <span class="mi">201</span><span class="p">)</span>    <span class="n">float64</span>           <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">Å</span><span class="p">]</span>  <span class="p">[</span><span class="mf">0.00455675</span><span class="p">,</span> <span class="mf">0.00548798</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.189871</span><span class="p">,</span> <span class="mf">0.190802</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make common bins, restricting the range to avoid NaNs</span>
<span class="n">qbins</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="mf">5.0e-3</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;1/angstrom&quot;</span><span class="p">)</span>

<span class="c1"># Histogram both sample and flat-field with same bins</span>
<span class="n">sample_h</span> <span class="o">=</span> <span class="n">sample_q</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">qbins</span><span class="p">)</span>
<span class="n">flat_h</span> <span class="o">=</span> <span class="n">flat_q</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">qbins</span><span class="p">)</span>

<span class="c1"># Normalize</span>
<span class="n">normed</span> <span class="o">=</span> <span class="n">sample_h</span> <span class="o">/</span> <span class="n">flat_h</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1.0e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0bed786c42f7628b3f5aa71ccd807ba634fd601e05974cb9f92b0a79a9510017.svg" src="../_images/0bed786c42f7628b3f5aa71ccd807ba634fd601e05974cb9f92b0a79a9510017.svg" />
</div>
</div>
</section>
<section id="save-result-to-disk">
<h2>Save result to disk<a class="headerlink" href="#save-result-to-disk" title="Link to this heading">#</a></h2>
<p>Finally, we need to save our results to disk,
so that the reduced data can be forwarded to the next step in the pipeline (data analysis).</p>
<p>We will use a simple text file for this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scippneutron.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_xye</span>

<span class="c1"># The simple file format does not support bin-edge coordinates.</span>
<span class="c1"># So we convert to bin-centers first.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">normed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">midpoints</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">])</span>

<span class="n">save_xye</span><span class="p">(</span><span class="s2">&quot;sans_iofq.dat&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="bonus-exercise">
<h2>Bonus exercise<a class="headerlink" href="#bonus-exercise" title="Link to this heading">#</a></h2>
<p>Re-run the reduction using the results from the simulations with less neutrons,
and compare the results.</p>
<p><strong>Solution:</strong></p>
<div class="cell tag_hide-input tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cases</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fewer_neutrons&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;many_neutrons&quot;</span><span class="p">:</span> <span class="s2">&quot;_many_neutrons&quot;</span><span class="p">}</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sample&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;normalized&quot;</span><span class="p">:</span> <span class="mf">5.0e-3</span><span class="p">}</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_sans</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../3-mcstas/SANS_with_sample</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">flat</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_sans</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../3-mcstas/SANS_without_sample</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">sample_q</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">qbins</span><span class="p">)</span>
    <span class="n">flat_q</span> <span class="o">=</span> <span class="n">flat</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">qbins</span><span class="p">)</span>
    <span class="n">normed</span> <span class="o">=</span> <span class="n">sample_q</span> <span class="o">/</span> <span class="n">flat_q</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normalized&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">normed</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_q</span>

<span class="n">figs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<span class="n">figs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">figs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/9c06f5771bb27416e90406ba5937fec830355c5beb5ce45010ead00004fd3a69.svg" src="../_images/9c06f5771bb27416e90406ba5937fec830355c5beb5ce45010ead00004fd3a69.svg" />
</div>
</div>
</section>
<section id="sciline-workflow">
<h2>Sciline workflow<a class="headerlink" href="#sciline-workflow" title="Link to this heading">#</a></h2>
<div class="alert alert-warning">
<p><strong>Pause here if you have not yet been introduced to Sciline!</strong></p>
</div>
<p>Below we build a Sciline workflow for reducing the SANS data.
We wrap the operations that were carried out throughout this notebook into function that have the correct type-annotations,
building a pipeline of connected steps.</p>
<p>The custom types have been created for you in the <code class="docutils literal notranslate"><span class="pre">sans_utils</span></code> module, and are imported from there.</p>
<p>Take some time to read through the code and understand the different parts.
Ask questions if anything is unclear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sciline</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sans_utils</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span> <span class="n">Foldername</span><span class="p">[</span><span class="n">RunType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">RawData</span><span class="p">[</span><span class="n">RunType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load raw data from file&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">RawData</span><span class="p">[</span><span class="n">RunType</span><span class="p">](</span><span class="n">utils</span><span class="o">.</span><span class="n">load_sans</span><span class="p">(</span><span class="n">folder</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">to_wavelength</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">RawData</span><span class="p">[</span><span class="n">RunType</span><span class="p">],</span> <span class="n">graph</span><span class="p">:</span> <span class="n">CoordTransformGraph</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WavelengthData</span><span class="p">[</span><span class="n">RunType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute wavelength for events&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">WavelengthData</span><span class="p">[</span><span class="n">RunType</span><span class="p">](</span><span class="n">data</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">to_Q</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">WavelengthData</span><span class="p">[</span><span class="n">RunType</span><span class="p">],</span> <span class="n">graph</span><span class="p">:</span> <span class="n">CoordTransformGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QData</span><span class="p">[</span><span class="n">RunType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Q for events&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">QData</span><span class="p">[</span><span class="n">RunType</span><span class="p">](</span><span class="n">data</span><span class="o">.</span><span class="n">transform_coords</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">to_histogram</span><span class="p">(</span><span class="n">events</span><span class="p">:</span> <span class="n">QData</span><span class="p">[</span><span class="n">RunType</span><span class="p">],</span> <span class="n">qbins</span><span class="p">:</span> <span class="n">QBins</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QHistogram</span><span class="p">[</span><span class="n">RunType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Histogram data in Q bins&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">QHistogram</span><span class="p">[</span><span class="n">RunType</span><span class="p">](</span><span class="n">events</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Q</span><span class="o">=</span><span class="n">qbins</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">QHistogram</span><span class="p">[</span><span class="n">SampleRun</span><span class="p">],</span> <span class="n">flat</span><span class="p">:</span> <span class="n">QHistogram</span><span class="p">[</span><span class="n">FlatFieldRun</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NormalizedQ</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalized sample by flat-field&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">NormalizedQ</span><span class="p">(</span><span class="n">sample</span> <span class="o">/</span> <span class="n">flat</span><span class="p">)</span>


<span class="n">wf</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="p">(</span><span class="n">load</span><span class="p">,</span> <span class="n">to_wavelength</span><span class="p">,</span> <span class="n">to_Q</span><span class="p">,</span> <span class="n">to_histogram</span><span class="p">,</span> <span class="n">normalize</span><span class="p">),</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">{</span><span class="n">RunType</span><span class="p">:</span> <span class="p">[</span><span class="n">SampleRun</span><span class="p">,</span> <span class="n">FlatFieldRun</span><span class="p">]},</span>
<span class="p">)</span>

<span class="n">wf</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c266157ca309274e6863d1e51282b2e94a89c598247d536c267d9d3b52b71d1c.svg" src="../_images/c266157ca309274e6863d1e51282b2e94a89c598247d536c267d9d3b52b71d1c.svg" />
</div>
</div>
<section id="exercise-4-set-the-workflow-parameters">
<h3>Exercise 4: Set the workflow parameters<a class="headerlink" href="#exercise-4-set-the-workflow-parameters" title="Link to this heading">#</a></h3>
<p>In the visualization above, the red boxes indicate missing values;
parameters required by the computation that have yet to be set on the workflow.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">wf[TYPE]</span> <span class="pre">=</span> <span class="pre">VALUE</span></code> syntax, set the missing parameters on the workflow.</p>
<p>Once you have done so, use <code class="docutils literal notranslate"><span class="pre">wf.compute(NormalizedQ)</span></code> to compute the final normalized result.</p>
<p><strong>Solution:</strong></p>
<div class="cell tag_hide-cell tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf</span><span class="p">[</span><span class="n">Foldername</span><span class="p">[</span><span class="n">SampleRun</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;../3-mcstas/SANS_with_sample_many_neutrons&quot;</span>
<span class="n">wf</span><span class="p">[</span><span class="n">Foldername</span><span class="p">[</span><span class="n">FlatFieldRun</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;../3-mcstas/SANS_without_sample_many_neutrons&quot;</span>

<span class="n">wf</span><span class="p">[</span><span class="n">CoordTransformGraph</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span>
<span class="n">wf</span><span class="p">[</span><span class="n">QBins</span><span class="p">]</span> <span class="o">=</span> <span class="n">qbins</span>

<span class="n">iofq</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">NormalizedQ</span><span class="p">)</span>
<span class="n">iofq</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ea082a7f8838ded2f2a5abec3e0aa48a9b5200c0bd834a7f5bf7ff2d2a40d34a.svg" src="../_images/ea082a7f8838ded2f2a5abec3e0aa48a9b5200c0bd834a7f5bf7ff2d2a40d34a.svg" />
</div>
</details>
</div>
</section>
<section id="exercise-5-make-a-2-theta-q-map">
<h3>Exercise 5: Make a <span class="math notranslate nohighlight">\((2\theta, Q)\)</span> map<a class="headerlink" href="#exercise-5-make-a-2-theta-q-map" title="Link to this heading">#</a></h3>
<p>We wish to make a 2d plot of counts as a function of <span class="math notranslate nohighlight">\(2\theta\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> for the <code class="docutils literal notranslate"><span class="pre">SampleRun</span></code>.
You have to:</p>
<ul class="simple">
<li><p>identify one of the intermediate results that would contain the necessary information</p></li>
<li><p>compute that intermediate result</p></li>
<li><p>histogram the result (200 bins in <code class="docutils literal notranslate"><span class="pre">two_theta</span></code> and 200 bins in <code class="docutils literal notranslate"><span class="pre">Q</span></code> will do nicely)</p></li>
<li><p>plot it on a figure</p></li>
</ul>
<p><strong>Hint:</strong> Using <code class="docutils literal notranslate"><span class="pre">norm='log',</span> <span class="pre">vmin=1.0e-4</span></code> when plotting makes for a better-looking figure.</p>
<p><strong>Solution:</strong></p>
<div class="cell tag_hide-cell tag_solution docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell content</p>
<p class="expanded admonition-title">Hide code cell content</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">QData</span><span class="p">[</span><span class="n">SampleRun</span><span class="p">])</span>
<span class="n">da</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">two_theta</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">1.0e-4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/18cf1150247500de6a9b42015b044645e64b077ba4ec04a534b9b36100837113.svg" src="../_images/18cf1150247500de6a9b42015b044645e64b077ba4ec04a534b9b36100837113.svg" />
</div>
</details>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./4-reduction"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="reduction-qens.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">QENS data reduction</p>
      </div>
    </a>
    <a class="right-next"
       href="../5-analysis/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model-dependent analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#process-the-run-with-a-sample">Process the run with a sample</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-nexus-file-data">Load the NeXus file data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-data">Visualize the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-transformations">Coordinate transformations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-convert-raw-data-to-q">Exercise 1: convert raw data to <span class="math notranslate nohighlight">\(Q\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram-the-data-in-q">Histogram the data in <span class="math notranslate nohighlight">\(Q\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-process-flat-field-run">Exercise 2: process flat-field run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-normalize-the-sample-run">Exercise 3: Normalize the sample run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-result-to-disk">Save result to disk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bonus-exercise">Bonus exercise</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sciline-workflow">Sciline workflow</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-set-the-workflow-parameters">Exercise 4: Set the workflow parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-5-make-a-2-theta-q-map">Exercise 5: Make a <span class="math notranslate nohighlight">\((2\theta, Q)\)</span> map</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Data Management and Scientific Computing centre
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>